<article class="pt-2">
    <div class="article-meta text-beargray cover bg-center bg-clip-text bg-cover backdrop-filter backdrop-blur-lg">

        {{ $date := .Date }}
        {{ $wordcount := .WordCount }}
        {{ with .Params.tags }}
        <div class="article-tags px-6 sm:px-5 font-button text-code items-center mt-3">
            <span class="text-deepgray mr-1"> {{ dateFormat "Jan 2, 2006" $date }} </span>
            <span class="ml-2">/</span>
            {{ range . }}
            {{ $page := site.GetPage (printf "/tags/%s" .) }}
            <span class="hover:text-bqbg  transition ease-linear duration-300 cursor-pointer overflow-hidden">
                <a href="{{ $page.RelPermalink }}" title="{{ . }}" style="line-height: 32px"
                    class="hover:bg-buttontext inline-block mx-1 px-3 text-sm border-tagborder rounded font-button">
                    #{{ . }}
                </a>
            </span>

            {{ end }}
        </div>
        {{ end }}
        <h1 class=" text-maintext text-title font-medium w-full pt-2 pb-3 mb-2 mt-1 px-6 sm:px-5">
            <span class="lg:text-3xl text-title ">{{ .Title }}</span>
            {{ if in .Site.Params.mainSections .Type }}
            <sup class=" text-sm text-tagborder "> {{ $wordcount }} Words</sup>
            {{end}}
        </h1>
        {{ with .Params.Subtitle }}
        <h5 class="text-deepgray text-xl font-medium pb-3 px-6 sm:px-5 mb-3"><span>{{ . }}</span></h5>
        {{ end }}
    </div>
    {{ if in .Site.Params.mainSections .Type }}
    {{ $days := div (sub now.Unix .Date.Unix) 86400 }}
    {{ if gt $days 180 }}
    <blockquote id="out-dated" class="border-bqborder bg-bqbg">
        <p class="">本文最近一次更新于
            {{ $year := div $days 360 }}
            {{ $month := div $days 30 }}
            {{ if gt $year 0 }}
            {{ $year }} 年
            {{ if gt (mod $month 12) 0 }}
            零 {{ mod $month 12 }} 个月
            {{end}}
            {{ else }}
            {{ mod $month 12 }} 个月
            {{ end }}
            前，其中所包含的信息很可能已经有所发展或是发生改变。</p>
    </blockquote>
    {{ end }}
    {{ end }}
    <div class="h-2"></div>
    <content class="{{ with .Params.encrypt_pwd }} hidden {{ end }}" {{ with .Params.encrypt_pwd }} data-password={{.}}
        {{ end }}>
        {{ .Content }}
    </content>
    {{ with .Params.encrypt_pwd }}
    <script>window.blog_encrypted = true</script>
    <script src=" https://cdn.jsdelivr.net/npm/crypto-js@4.0.0/crypto-js.min.js" crossorigin async defer>
    </script>
    <script>
        appendLeft = (passwd, length) => {
            pwd = ''
            for (let i = passwd.length; i < 16; i++)
                pwd += 'a'
            return pwd + passwd
        }
        DoDecrypt = (pwd, ele) => {
            pwd = appendLeft(pwd, 16);
            let key = CryptoJS.enc.Utf8.parse(pwd),
                encryptedHexStr = CryptoJS.enc.Hex.parse(ele.innerHTML),
                encryptedBase64Str = CryptoJS.enc.Base64.stringify(encryptedHexStr);
            decrypted = CryptoJS.AES.decrypt(encryptedBase64Str, key, {
                iv: key,
                mode: CryptoJS.mode.CBC,
                padding: CryptoJS.pad.Pkcs7
            });
            try {
                ele.innerHTML = decrypted.toString(CryptoJS.enc.Utf8);
                ele.classList.remove('hidden')
                document.getElementById('input').remove()
            } catch {
                console.log("Error Password")
                document.getElementById("error_msg").classList.remove('hidden')
            }

        }
        EnterPress = (event) => {
            console.log(event)
            var keyCode = event.which || event.keyCode;
            if (keyCode !== 13) return
            const passwd = document.getElementById("input").querySelector("input").value
            DoDecrypt(passwd, document.getElementsByTagName('content')[0])
        }
    </script>
    <div id="input" class="my-4">
        <input type="text" placeholder="🔑 Input Password, Press `Enter`" onkeydown="EnterPress"
            onkeypress="EnterPress(event)"
            class="transition ease-linear duration-300 border-hyper w-64 border-b-2 px-2 py-1 focus:border-hyper focus:outline-none">
        <span id="error_msg" class="text-red-600 pl-6 hidden">🙅Wrong Password！</span>
    </div>
    {{ end }}
    {{ if in .Site.Params.mainSections .Type }}
    {{ partial "widget/article-info/article-stats" . }}
    {{ end }}
    <div id="svelte"></div>
    {{$.Scratch.Set "svelte" false}}
</article>